<!DOCTYPE html>
<html>
<head>
    <title>ExportåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .blue { background-color: #f0f8ff; }
        .green { background-color: #f0fff0; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
        input[type="password"] { width: 300px; padding: 8px; }
    </style>
</head>
<body>
    <h1>KSS Rating Platform - ExportåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="section blue">
        <h2>ğŸ“Š Excelå¯¼å‡ºæµ‹è¯•</h2>
        <p>ç‚¹å‡»æŒ‰é’®ç›´æ¥æµ‹è¯•Excelå¯¼å‡ºï¼ˆéœ€è¦å…ˆç™»å½•è·å–tokenï¼‰</p>
        <button onclick="exportExcel()">ä¸‹è½½ Excel æ–‡ä»¶</button>
        <div id="excel-result"></div>
    </div>
    
    <div class="section green">
        <h2>ğŸ¤– LLMæ ¼å¼åŒ–å¯¼å‡ºæµ‹è¯•</h2>
        <p>è¾“å…¥OpenAI API Keyæµ‹è¯•LLMæ ¼å¼åŒ–åŠŸèƒ½</p>
        <label>API Key: <input type="password" id="apiKey" placeholder="sk-..."></label><br>
        <label>JSONæ ¼å¼æ ·æœ¬:</label><br>
        <textarea id="sampleFormat">{
  "metadata": {
    "export_date": "2024-01-15",
    "total_images": 0,
    "total_scores": 0
  },
  "images": [
    {
      "filename": "image_001.jpg",
      "original_name": "sample_image.jpg",
      "dataset": "drowsiness_study_2024",
      "scores": [
        {
          "scorer": "user123",
          "kss_score": 5,
          "explanation": "Person shows moderate signs of sleepiness...",
          "time_spent": 45,
          "scored_date": "2024-01-15T10:30:00Z"
        }
      ],
      "statistics": {
        "average_score": 5.2,
        "score_count": 3,
        "min_score": 4,
        "max_score": 7
      }
    }
  ]
}</textarea><br>
        <button onclick="exportLLM()">ç”Ÿæˆæ ¼å¼åŒ– JSON</button>
        <div id="llm-result"></div>
    </div>

    <script>
        // çœŸå®çš„JWT token (å·²é€šè¿‡adminç™»å½•è·å–)
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiIsImVtYWlsIjoiYWRtaW5Aa3NzLmNvbSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzEyOTkwMiwiZXhwIjoxNzUzNzM0NzAyfQ.z80TZ2JGd4QdxrlS_I06NBrKhThFfYfYLECsYgvEYlE';

        function exportExcel() {
            const resultDiv = document.getElementById('excel-result');
            resultDiv.innerHTML = 'Excelå¯¼å‡ºæ­£åœ¨ä¸‹è½½...';
            
            fetch('http://localhost:3001/api/admin/export/excel', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                } else {
                    throw new Error('å¯¼å‡ºå¤±è´¥: ' + response.status);
                }
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kss_scores_${new Date().toISOString().split('T')[0]}.xlsx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                resultDiv.innerHTML = 'âœ… Excelæ–‡ä»¶å·²ä¸‹è½½!';
            })
            .catch(error => {
                resultDiv.innerHTML = 'âŒ é”™è¯¯: ' + error.message;
            });
        }

        function exportLLM() {
            const apiKey = document.getElementById('apiKey').value;
            const sampleFormat = document.getElementById('sampleFormat').value;
            const resultDiv = document.getElementById('llm-result');
            
            if (!apiKey) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥API Key';
                return;
            }
            
            resultDiv.innerHTML = 'AIæ­£åœ¨å¤„ç†æ•°æ®...';
            
            fetch('http://localhost:3001/api/admin/export/llm-json', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    apiKey: apiKey,
                    sampleFormat: sampleFormat,
                    includeExplanations: true
                })
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                } else {
                    throw new Error('LLMå¯¼å‡ºå¤±è´¥: ' + response.status);
                }
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kss_scores_formatted_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                resultDiv.innerHTML = 'âœ… LLMæ ¼å¼åŒ–JSONæ–‡ä»¶å·²ä¸‹è½½!';
            })
            .catch(error => {
                resultDiv.innerHTML = 'âŒ é”™è¯¯: ' + error.message;
            });
        }
    </script>
</body>
</html> 